<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <title>Novo Usuário — Admin Paróquia</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

  <style>
    :root{
      --ink:#0f172a; --muted:#64748b; --ring:rgba(37,99,235,.18);
      --g1:#0b1020; --g2:#111a3a;
      --base-font:14px;

      --line:#e5e7eb; --panel:#fff;
      --accent:#2563eb; --accent-2:#1d4ed8;
      --warn:#f59e0b;
    }
    html{ font-size:var(--base-font); }
    body{ background:#f6f8fb; color:var(--ink); }

    /* Navbar catálogo */
    .nav-pro{ background:linear-gradient(90deg,var(--g1),var(--g2)); }
    .navbar-brand{ font-size:1rem; }
    .navbar .btn{ font-size:.85rem; padding:.35rem .6rem; }

    /* “Hero” compacto (estilo do painel refeito) */
    .sticky-topbar{ position:sticky; top:0; z-index:20; background:#ffffffd6; backdrop-filter:blur(6px); }
    .text-muted-2{ color:var(--muted); }

    /* Painel / cartão limpo catálogo */
    .card-clean{
      background:var(--panel); border:1px solid var(--line); border-radius:.9rem;
      box-shadow:0 10px 24px rgba(17,24,39,.08);
      transition:transform .12s ease, box-shadow .12s ease;
    }
    .card-clean:hover{ transform:translateY(-1px); box-shadow:0 12px 28px rgba(17,24,39,.12); }

    /* Form padrão catálogo */
    .form-label{ font-weight:700; color:var(--muted); font-size:.9rem; }
    .form-control, .form-select, textarea{
      border-radius:.8rem; border-color:var(--line); padding:.6rem .8rem; font-size:.95rem;
      background:#fff;
    }
    .form-control:focus, .form-select:focus, textarea:focus{
      border-color:#93c5fd; box-shadow:0 0 0 .25rem var(--ring);
    }
    .req{ color:var(--warn); margin-left:4px; }

    /* Password toggle + strength */
    .pw-wrap{ position:relative; }
    .pw-toggle{
      position:absolute; right:.5rem; top:50%; transform:translateY(-50%);
      border:1px solid var(--line); background:#fff; color:var(--muted);
      padding:.35rem .55rem; border-radius:.6rem; cursor:pointer; font-weight:700; font-size:.85rem;
    }
    .strength{ display:flex; gap:6px; margin-top:6px }
    .bar{ height:6px; flex:1; border-radius:6px; background:#e5e7eb; border:1px solid var(--line) }
    .bar.f1{ background:#fca5a5; border-color:#f87171 }
    .bar.f2{ background:#fde68a; border-color:#f59e0b }
    .bar.f3{ background:#86efac; border-color:#22c55e }
    .bar.f4{ background:#34d399; border-color:#16a34a }

    .btn.btn-sm, .btn-sm{ font-size:.85rem; padding:.45rem .65rem; }
  </style>
</head>
<body>

<!-- NAVBAR catálogo -->
<nav class="navbar nav-pro navbar-dark">
  <div class="container-fluid">
    <a class="navbar-brand fw-bold" href="{% url 'inscricoes:admin_geral_dashboard' %}">Admin Paróquia</a>

    <div class="d-flex align-items-center gap-2 ms-auto">
      <a class="btn btn-sm btn-outline-light" href="{% url 'inscricoes:admin_geral_list_usuarios' %}">← Lista de Usuários</a>
      <button type="button" class="btn btn-sm btn-light" id="themeToggle" aria-label="Alternar tema">Tema</button>
    </div>
  </div>
</nav>

<main class="container py-3 py-lg-4">

  <!-- Cabeçalho compacto -->
  <div class="sticky-topbar border rounded-3 p-3 mb-3 bg-white">
    <div class="d-flex flex-wrap align-items-center justify-content-between gap-2">
      <div>
        <h1 class="h6 m-0">Criar Usuário — Admin Paróquia</h1>
        <div class="small text-muted-2">Preencha os dados para conceder acesso administrativo.</div>
      </div>
      <div class="d-flex gap-2">
        <a href="{% url 'inscricoes:admin_geral_list_usuarios' %}" class="btn btn-outline-secondary btn-sm">Cancelar</a>
        <button form="userForm" type="submit" class="btn btn-primary btn-sm">Salvar</button>
      </div>
    </div>
  </div>

  <!-- Painel com formulário -->
  <section class="card-clean p-3 p-lg-4">
    <h2 class="h6 text-muted-2 mb-3"><i class="bi bi-person-plus"></i> Novo Usuário</h2>

    {% if form.non_field_errors %}
      <div class="alert alert-danger">
        {% for e in form.non_field_errors %}<div>{{ e }}</div>{% endfor %}
      </div>
    {% endif %}

    <form method="post" novalidate id="userForm" class="row g-3">
      {% csrf_token %}

      {# Render de campos com grid responsivo (colunas como no catálogo) #}
      {% for field in form %}
        {% with name=field.name|lower %}
          <div class="{% if 'telefone' in name or 'phone' in name %}col-12 col-md-4{% elif 'email' in name %}col-12 col-md-6{% elif 'password' in name %}col-12 col-md-6{% else %}col-12 col-md-6{% endif %}">
            <label class="form-label" for="{{ field.id_for_label }}">
              {{ field.label }}{% if field.field.required %}<span class="req">*</span>{% endif %}
            </label>

            {# campo #}
            {{ field }}

            {# help #}
            {% if field.help_text %}
              <div class="form-text">{{ field.help_text|safe }}</div>
            {% endif %}

            {# errors #}
            {% if field.errors %}
              <div class="mt-1">
                {% for error in field.errors %}
                  <div class="alert alert-danger py-1 px-2 mb-1">{{ error }}</div>
                {% endfor %}
              </div>
            {% endif %}

            {# barra de força no primeiro password #}
            {% if 'password' in name %}
              <div class="strength" aria-hidden="true" hidden>
                <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
              </div>
            {% endif %}
          </div>
        {% endwith %}
      {% endfor %}

      <div class="col-12 d-flex gap-2 justify-content-end">
        <a href="{% url 'inscricoes:admin_geral_list_usuarios' %}" class="btn btn-outline-secondary btn-sm">Cancelar</a>
        <button type="submit" class="btn btn-primary btn-sm">Salvar</button>
      </div>
      <p class="small text-muted-2 m-0">Dica: use <kbd>Ctrl</kbd>+<kbd>Enter</kbd> (ou <kbd>⌘</kbd>+<kbd>Enter</kbd>) para enviar.</p>
    </form>
  </section>

  <footer class="py-4">
    <div class="d-flex flex-wrap justify-content-between align-items-center text-muted-2 small">
      <div>© {% now "Y" %} Admin Geral — Todos os direitos reservados</div>
      <div>Desenvolvido por Alexandre Martins Vieira • Bootstrap 5</div>
    </div>
  </footer>
</main>

<script>
  // Tema com persistência (mesma chave das outras telas)
  (function themeToggle(){
    const KEY='relatorios-theme';
    const btn=document.getElementById('themeToggle');
    const root=document.documentElement;
    function apply(theme){
      if(theme==='dark'){ root.dataset.theme='dark'; document.documentElement.style.colorScheme='dark'; }
      else if(theme==='light'){ root.dataset.theme='light'; document.documentElement.style.colorScheme='light'; }
      else{ root.removeAttribute('data-theme'); document.documentElement.style.colorScheme='light dark'; }
    }
    apply(localStorage.getItem(KEY) || 'auto');
    btn?.addEventListener('click', ()=>{
      const cur=localStorage.getItem(KEY)||'auto';
      const next= cur==='auto' ? 'dark' : cur==='dark' ? 'light' : 'auto';
      localStorage.setItem(KEY,next); apply(next);
      btn.setAttribute('aria-label',`Tema: ${next}`);
    });
  })();

  // UX do formulário: foco, Ctrl/Cmd+Enter, toggle de senha e força
  (function formUX(){
    const form = document.getElementById('userForm');
    if(!form) return;

    // Foco no primeiro controle
    const first = form.querySelector('input, select, textarea');
    first && first.focus();

    // Ctrl/Cmd + Enter para enviar
    document.addEventListener('keydown', (e)=>{
      if((e.ctrlKey || e.metaKey) && e.key.toLowerCase()==='enter'){
        e.preventDefault();
        form.requestSubmit();
      }
    });

    // Envelopa inputs de senha com pw-wrap e adiciona toggle
    const pwInputs = Array.from(form.querySelectorAll('input[type="password"]'));
    pwInputs.forEach((input, idx)=>{
      // só se ainda não estiver wrapado
      if(!input.parentElement.classList.contains('pw-wrap')){
        const wrap = document.createElement('div');
        wrap.className = 'pw-wrap';
        input.parentNode.insertBefore(wrap, input);
        wrap.appendChild(input);

        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'pw-toggle';
        btn.textContent = 'Ver';
        btn.addEventListener('click', ()=>{
          const show = input.type === 'password';
          input.type = show ? 'text' : 'password';
          btn.textContent = show ? 'Ocultar' : 'Ver';
        });
        wrap.appendChild(btn);
      }

      // força da senha no primeiro campo
      if(idx === 0){
        const strength = input.closest('.col-12, .col-md-6, .col-md-4')?.querySelector('.strength');
        if(strength){
          strength.hidden = false;
          const bars = strength.querySelectorAll('.bar');
          const score = (v)=>{
            let s = 0;
            if(v.length >= 8) s++;
            if(/[A-Z]/.test(v) && /[a-z]/.test(v)) s++;
            if(/\d/.test(v)) s++;
            if(/[^A-Za-z0-9]/.test(v)) s++;
            return s;
          };
          input.addEventListener('input', ()=>{
            const n = score(input.value);
            bars.forEach((b,i)=>{
              b.classList.remove('f1','f2','f3','f4');
              if(n>0 && i < n) b.classList.add('f'+n);
            });
          });
        }
      }
    });

    // Mascara simples para telefone (se houver)
    const phones = form.querySelectorAll('input[type="tel"]');
    phones.forEach(p=>{
      p.addEventListener('input', ()=>{
        let v = p.value.replace(/\D/g,'').slice(0,11);
        if(v.length > 10) p.value = v.replace(/(\d{2})(\d{5})(\d{4})/,'($1) $2-$3');
        else if(v.length > 6) p.value = v.replace(/(\d{2})(\d{4})(\d{0,4})/,'($1) $2-$3');
        else if(v.length > 2) p.value = v.replace(/(\d{2})(\d{0,5})/,'($1) $2');
        else p.value = v;
      });
    });
  })();
</script>
</body>
</html>
