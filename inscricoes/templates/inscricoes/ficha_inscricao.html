{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Ficha de Inscrição • {{ inscricao.evento.nome|default:"não informado" }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    /* ===== Página / Tema ===== */
    @page { size: A4 portrait; margin: 6mm; }
    :root{
      --ink:#0f172a; --muted:#6b7280; --line:#e5e7eb; --bg:#ffffff; --panel:#ffffff;
      --chip:#eef2ff; --chip-ink:#3730a3; --accent:#2563eb;
    }
    @media (prefers-color-scheme: dark){
      :root{ --ink:#e5e7eb; --muted:#94a3b8; --line:#1f2937; --bg:#0b1220; --panel:#0f1526; --chip:#0b1a4a; --chip-ink:#a5b4fc; }
    }

    *{ box-sizing:border-box }
    html,body{ margin:0 }
    body{
      background:var(--bg);
      color:var(--ink);
      font-family:'Nunito Sans', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      font-size:12px; line-height:1.35;
      -webkit-print-color-adjust:exact; print-color-adjust:exact;
    }

    /* ===== Folha ===== */
    .wrap{ max-width:210mm; margin:0 auto; padding:6mm }
    .sheet{
      background:var(--panel);
      border:1px solid var(--line);
      border-radius:12px;
      padding:8mm 7mm 6mm;
      page-break-inside:avoid; page-break-after:always;
    }

    /* ===== Barra de ações (não imprime) ===== */
    .toolbar{ display:flex; justify-content:center; gap:8px; padding:8px }
    .btn{
      appearance:none; border:1px solid var(--line); background:#fff; color:#111827;
      padding:8px 12px; border-radius:10px; font-weight:800; cursor:pointer; text-decoration:none; font-size:11px;
    }
    .btn-primary{ background:var(--accent); color:#fff; border-color:transparent }

    /* ===== Cabeçalho ===== */
    .top{
      display:grid; grid-template-columns: 1fr auto; gap:12px; align-items:center;
      padding-bottom:6px; border-bottom:1px solid var(--line); margin-bottom:8px;
    }
    .eyebrow{ color:var(--muted); font-size:10px; margin:0 0 2px }
    .t-title{ margin:0; font-weight:800; font-size:15px; line-height:1.1; letter-spacing:.2px }
    .t-sub{ margin:4px 0 0; color:var(--muted); font-size:10px; max-width:130mm; white-space:nowrap; overflow:hidden; text-overflow:ellipsis }
    .media{ display:flex; align-items:center; gap:10px }
    .photo{
      width:56px; height:56px; border-radius:10px; object-fit:cover;
      border:1px solid var(--line); background:#f3f4f6;
      display:block;
    }
    .photo.-empty{ display:grid; place-items:center; color:#9ca3af; font-size:9px }
    .qr-wrap{ display:grid; grid-template-rows:auto auto; gap:4px; justify-items:center }
    .qr{
      width:74px; height:74px; border:1px solid var(--line); border-radius:8px; padding:2px; background:#fff;
    }
    .qr-caption{ font-size:9px; color:var(--muted) }

    /* ===== Seções / Grid de campos ===== */
    .sec{ margin:10px 0 12px }
    .sec h3{
      margin:0 0 6px; font-size:11px; letter-spacing:.3px; color:#111;
      text-transform:uppercase;
    }

    .grid{
      display:grid; grid-template-columns:repeat(18,1fr); gap:6px;
    }

    .f{ display:flex; flex-direction:column; min-width:0 }
    .f label{ font-size:9px; color:var(--muted); margin-bottom:2px; line-height:1; letter-spacing:.2px }
    .v{
      border:1px solid var(--line); border-radius:6px; padding:6px 8px; min-height:24px;
      display:flex; align-items:center; background:#fff; overflow:hidden; white-space:nowrap; text-overflow:ellipsis;
    }
    .v-wrap{ white-space:normal; word-break:break-word; overflow:visible }

    .span-18{grid-column:span 18}.span-16{grid-column:span 16}.span-12{grid-column:span 12}
    .span-10{grid-column:span 10}.span-9{grid-column:span 9}
    .span-8{grid-column:span 8}.span-7{grid-column:span 7}
    .span-6{grid-column:span 6}.span-5{grid-column:span 5}
    .span-4{grid-column:span 4}.span-3{grid-column:span 3}
    .span-2{grid-column:span 2}.span-1{grid-column:span 1}

    /* ===== Chips (opcional para destaques) ===== */
    .chip{ display:inline-flex; align-items:center; gap:6px; padding:2px 8px; border-radius:999px; background:var(--chip); color:var(--chip-ink); font-weight:800; font-size:10px }

    /* ===== Rodapé ===== */
    .footer{ margin-top:8px; text-align:center; font-size:9px; color:var(--muted) }
    .footer img{ display:block; margin:0 auto 4px; max-height:16px }

    /* ===== Print ===== */
    @media print{
      body{ font-size:10px }
      .sheet{ border:none; border-radius:0; padding:6mm 5mm 4mm }
      .t-title{ font-size:13px }
      .t-sub{ font-size:9px; max-width:140mm }
      .photo{ width:48px; height:48px }
      .qr{ width:64px; height:64px; border-radius:6px }
      .toolbar{ display:none !important }
      .sec{ margin:8px 0 10px }
      .grid{ gap:4px }
      .v{ padding:4px 6px; min-height:20px }
    }
  </style>
</head>
<body>

  <!-- Barra (não imprime) -->
  <div class="toolbar">
    <button class="btn btn-primary" onclick="window.print()">
      Imprimir
    </button>
  </div>

  <div class="wrap">
    <div class="sheet">
      <!-- Cabeçalho -->
      <div class="top">
        <div>
          <p class="eyebrow">Ficha de inscrição</p>
          <h1 class="t-title">{{ inscricao.evento.nome|default:"não informado" }}</h1>
          <div class="t-sub">
            Participante: {{ inscricao.participante.nome|default:"não informado" }}
          </div>
        </div>
        <div class="media">
          {% if inscricao.participante.foto %}
            <img class="photo" src="{{ inscricao.participante.foto.url }}" alt="Foto do participante">
          {% else %}
            <div class="photo -empty">sem foto</div>
          {% endif %}
          <div class="qr-wrap">
            <img class="qr" src="{% url 'inscricoes:qr_code_png' inscricao.participante.qr_token %}" alt="QR participante">
            <div class="qr-caption">Check-in</div>
          </div>
        </div>
      </div>

      <!-- Participante -->
      <div class="sec">
        <h3>Participante</h3>
        <div class="grid">
          <div class="f span-12"><label>Nome</label><div class="v v-wrap">{{ inscricao.participante.nome|default:"não informado" }}</div></div>
          <div class="f span-3"><label>Nasc.</label><div class="v">{{ inscricao_base.data_nascimento|date:"d/m/Y"|default:"não informado" }}</div></div>
          <div class="f span-3"><label>CPF</label><div class="v">{{ inscricao.participante.cpf|default:"não informado" }}</div></div>

          <div class="f span-4"><label>Telefone</label><div class="v">{{ inscricao.participante.telefone|default:"não informado" }}</div></div>
          <div class="f span-8"><label>E-mail</label><div class="v v-wrap">{{ inscricao.participante.email|default:"não informado" }}</div></div>
          <div class="f span-3"><label>CEP</label><div class="v">{{ inscricao.participante.CEP|default:"não informado" }}</div></div>
          <div class="f span-3"><label>Nº</label><div class="v">{{ inscricao.participante.numero|default:"não informado" }}</div></div>

          <div class="f span-8"><label>Endereço</label><div class="v v-wrap">{{ inscricao.participante.endereco|default:"não informado" }}</div></div>
          <div class="f span-4"><label>Bairro</label><div class="v">{{ inscricao.participante.bairro|default:"não informado" }}</div></div>
          <div class="f span-6"><label>Cidade</label><div class="v">{{ inscricao.participante.cidade|default:"não informado" }}</div></div>
          <div class="f span-2"><label>UF</label><div class="v">{{ inscricao.participante.estado|default:"não informado" }}</div></div>
        </div>
      </div>

      <!-- Dados adicionais -->
      <div class="sec">
        <h3>Dados adicionais</h3>
        <div class="grid">
          <div class="f span-2"><label>Altura</label><div class="v">{{ inscricao_base.altura|default:"—" }}</div></div>
          <div class="f span-2"><label>Peso</label><div class="v">{{ inscricao_base.peso|default:"—" }}</div></div>
          <div class="f span-2"><label>Batizado?</label><div class="v">{{ inscricao_base.get_batizado_display|default:"—" }}</div></div>
          <div class="f span-4"><label>Estado civil</label><div class="v">{{ inscricao_base.get_estado_civil_display|default:"—" }}</div></div>
          <div class="f span-4"><label>Casado na Igreja?</label><div class="v">{{ inscricao_base.get_casado_na_igreja_display|default:"—" }}</div></div>

          <div class="f span-6"><label>Paróquia</label><div class="v v-wrap">{{ inscricao_base.paroquia|default:"—" }}</div></div>
          <div class="f span-6"><label>Pastoral/Movimento</label><div class="v v-wrap">{{ inscricao_base.pastoral_movimento|default:"—" }}</div></div>
          <div class="f span-6"><label>Outra Pastoral/Movimento</label><div class="v v-wrap">{{ inscricao_base.outra_pastoral_movimento|default:"—" }}</div></div>

          <div class="f span-2"><label>Dizimista?</label><div class="v">{{ inscricao_base.get_dizimista_display|default:"—" }}</div></div>
          <div class="f span-2"><label>Crismado?</label><div class="v">{{ inscricao_base.get_crismado_display|default:"—" }}</div></div>
          <div class="f span-2"><label>Camisa</label><div class="v">{{ inscricao_base.tamanho_camisa|default:"—" }}</div></div>

          <div class="f span-12"><label>Indicado por</label><div class="v v-wrap">{{ inscricao_base.indicado_por|default:"—" }}</div></div>
        </div>
      </div>

      <!-- Saúde -->
      <div class="sec">
        <h3>Saúde</h3>
        <div class="grid">
          <div class="f span-3"><label>Pressão alta?</label><div class="v">{{ inscricao_base.get_pressao_alta_display|default:"—" }}</div></div>
          <div class="f span-3"><label>Diabetes?</label><div class="v">{{ inscricao_base.get_diabetes_display|default:"—" }}</div></div>

          <div class="f span-2"><label>Prob. Saúde?</label><div class="v">{{ inscricao_base.get_problema_saude_display|default:"—" }}</div></div>
          <div class="f span-7"><label>Qual?</label><div class="v v-wrap">{{ inscricao_base.qual_problema_saude|default:"—" }}</div></div>
          <div class="f span-2"><label>Med. Ctrl.?</label><div class="v">{{ inscricao_base.get_medicamento_controlado_display|default:"—" }}</div></div>
          <div class="f span-7"><label>Qual?</label><div class="v v-wrap">{{ inscricao_base.qual_medicamento_controlado|default:"—" }}</div></div>

          <div class="f span-4"><label>Protocolo</label><div class="v v-wrap">{{ inscricao_base.protocolo_administracao|default:"—" }}</div></div>
          <div class="f span-2"><label>Mob. Red.?</label><div class="v">{{ inscricao_base.get_mobilidade_reduzida_display|default:"—" }}</div></div>
          <div class="f span-6"><label>Qual?</label><div class="v v-wrap">{{ inscricao_base.qual_mobilidade_reduzida|default:"—" }}</div></div>
          <div class="f span-2"><label>Tipo Sang.</label><div class="v">{{ inscricao_base.tipo_sanguineo|default:"—" }}</div></div>
          <div class="f span-4"><label><!-- espaço --></label><div class="v" style="border:none;background:transparent;min-height:0;padding:0"></div></div>

          <div class="f span-2"><label>Alerg. Alim.?</label><div class="v">{{ inscricao_base.get_alergia_alimento_display|default:"—" }}</div></div>
          <div class="f span-7"><label>Qual?</label><div class="v v-wrap">{{ inscricao_base.qual_alergia_alimento|default:"—" }}</div></div>
          <div class="f span-2"><label>Alerg. Med.?</label><div class="v">{{ inscricao_base.get_alergia_medicamento_display|default:"—" }}</div></div>
          <div class="f span-7"><label>Qual?</label><div class="v v-wrap">{{ inscricao_base.qual_alergia_medicamento|default:"—" }}</div></div>

          <div class="f span-18"><label>Informações extras</label><div class="v v-wrap">{{ inscricao_base.informacoes_extras|default:"—" }}</div></div>
        </div>
      </div>

      <!-- Cônjuge -->
      {% if inscricao.conjuge or inscricao_base.nome_conjuge %}
      <div class="sec">
        <h3>Cônjuge</h3>
        <div class="grid">
          {% if inscricao.conjuge %}
            <div class="f span-10"><label>Nome</label><div class="v v-wrap">{{ inscricao.conjuge.nome }}</div></div>
            <div class="f span-4"><label>Inscrito?</label><div class="v">{{ inscricao.conjuge.get_conjuge_inscrito_display }}</div></div>
            <div class="f span-4"><label>Já é campista?</label><div class="v">{{ inscricao.conjuge.get_ja_e_campista_display }}</div></div>
          {% else %}
            <div class="f span-10"><label>Nome</label><div class="v v-wrap">{{ inscricao_base.nome_conjuge }}</div></div>
            <div class="f span-4"><label>Inscrito?</label><div class="v">{{ inscricao_base.get_conjuge_inscrito_display }}</div></div>
            <div class="f span-4"><label><!-- vazio --></label><div class="v" style="border:none;background:transparent;min-height:0;padding:0"></div></div>
          {% endif %}
        </div>
      </div>
      {% endif %}

      <!-- Paróquia (da inscrição) -->
      <div class="sec">
        <h3>Paróquia (Inscrição)</h3>
        <div class="grid">
          <div class="f span-10"><label>Paróquia</label><div class="v v-wrap">{{ inscricao.paroquia.nome }}</div></div>
          <div class="f span-6"><label>Cidade</label><div class="v">{{ inscricao.paroquia.cidade }}</div></div>
          <div class="f span-2"><label>UF</label><div class="v">{{ inscricao.paroquia.estado }}</div></div>
        </div>
      </div>

      <!-- Responsáveis -->
      <div class="sec">
        <h3>Responsáveis</h3>
        <div class="grid">
          <div class="f span-10"><label>Resp. 1 — Nome</label><div class="v v-wrap">{{ inscricao.responsavel_1_nome }}</div></div>
          <div class="f span-4"><label>Telefone</label><div class="v">{{ inscricao.responsavel_1_telefone }}</div></div>
          <div class="f span-3"><label>Grau</label><div class="v">{{ inscricao.responsavel_1_grau_parentesco }}</div></div>
          <div class="f span-1"><label>Camp.</label><div class="v">{% if inscricao.responsavel_1_ja_e_campista %}Sim{% else %}Não{% endif %}</div></div>

          <div class="f span-10"><label>Resp. 2 — Nome</label><div class="v v-wrap">{{ inscricao.responsavel_2_nome }}</div></div>
          <div class="f span-4"><label>Telefone</label><div class="v">{{ inscricao.responsavel_2_telefone }}</div></div>
          <div class="f span-3"><label>Grau</label><div class="v">{{ inscricao.responsavel_2_grau_parentesco }}</div></div>
          <div class="f span-1"><label>Camp.</label><div class="v">{% if inscricao.responsavel_2_ja_e_campista %}Sim{% else %}Não{% endif %}</div></div>
        </div>
      </div>

      <!-- Emergência -->
      <div class="sec">
        <h3>Contato de emergência</h3>
        <div class="grid">
          <div class="f span-10"><label>Nome</label><div class="v v-wrap">{{ inscricao.contato_emergencia_nome }}</div></div>
          <div class="f span-4"><label>Telefone</label><div class="v">{{ inscricao.contato_emergencia_telefone }}</div></div>
          <div class="f span-3"><label>Grau</label><div class="v">{{ inscricao.contato_emergencia_grau_parentesco }}</div></div>
          <div class="f span-1"><label>Camp.</label><div class="v">{% if inscricao.contato_emergencia_ja_e_campista %}Sim{% else %}Não{% endif %}</div></div>
        </div>
      </div>

      <!-- Rodapé -->
      <div class="footer">
        <img src="{% static 'img/logo.png' %}" alt="Logo do sistema">
        Desenvolvido por Seu Nome / Sua Empresa
      </div>
    </div>
  </div>

</body>
</html>
