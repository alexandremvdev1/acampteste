<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <title>Novo — Paróquia | Admin Geral</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

  <style>
    :root{
      --ink:#0f172a; --muted:#64748b; --ring:rgba(37,99,235,.18);
      --g1:#0b1020; --g2:#111a3a;
      --base-font:14px;
      --line:#e5e7eb; --panel:#fff;
      --warn:#f59e0b;
    }
    html{ font-size:var(--base-font); }
    body{ background:#f6f8fb; color:var(--ink); }
    .text-muted-2{ color:var(--muted); }

    /* Navbar catálogo */
    .nav-pro{ background:linear-gradient(90deg,var(--g1),var(--g2)); }
    .navbar-brand{ font-size:1rem; }
    .navbar .btn{ font-size:.85rem; padding:.35rem .6rem; }

    /* Header/toolbar compacto */
    .sticky-topbar{ position:sticky; top:0; z-index:20; background:#ffffffd6; backdrop-filter:blur(6px); }

    /* Cartão limpo (catálogo) */
    .card-clean{
      background:var(--panel); border:1px solid var(--line); border-radius:.9rem;
      box-shadow:0 10px 24px rgba(17,24,39,.08);
      transition:transform .12s ease, box-shadow .12s ease;
    }
    .card-clean:hover{ transform:translateY(-1px); box-shadow:0 12px 28px rgba(17,24,39,.12); }

    /* Form padrão catálogo */
    .form-label{ font-weight:700; color:var(--muted); font-size:.9rem; }
    .form-control, .form-select, textarea{
      border-radius:.8rem; border-color:var(--line); padding:.6rem .8rem; font-size:.95rem; background:#fff;
    }
    .form-control:focus, .form-select:focus, textarea:focus{
      border-color:#93c5fd; box-shadow:0 0 0 .25rem var(--ring);
    }
    .req{ color:var(--warn); margin-left:4px; }

    .logo-preview{ display:flex; align-items:center; gap:.6rem; margin-top:.35rem; }
    .logo-preview img{
      width:56px; height:56px; object-fit:contain; border-radius:.6rem; border:1px solid var(--line); background:#fff;
    }

    .btn.btn-sm, .btn-sm{ font-size:.85rem; padding:.45rem .65rem; }
  </style>
</head>
<body>

<!-- NAVBAR catálogo -->
<nav class="navbar nav-pro navbar-dark">
  <div class="container-fluid">
    <a class="navbar-brand fw-bold" href="{% url 'inscricoes:admin_geral_dashboard' %}">Admin Geral</a>

    <div class="d-flex align-items-center gap-2 ms-auto">
      <a class="btn btn-sm btn-outline-light" href="{% url 'inscricoes:admin_geral_list_paroquias' %}">← Lista de Paróquias</a>
      <button type="button" class="btn btn-sm btn-light" id="themeToggle" aria-label="Alternar tema">Tema</button>
    </div>
  </div>
</nav>

<main class="container py-3 py-lg-4">

  <!-- Cabeçalho compacto -->
  <div class="sticky-topbar border rounded-3 p-3 mb-3 bg-white">
    <div class="d-flex flex-wrap align-items-center justify-content-between gap-2">
      <div>
        <h1 class="h6 m-0">Criar Nova Paróquia</h1>
        <div class="small text-muted-2">Cadastre dados institucionais, endereço e contato. Você pode anexar o logo.</div>
      </div>
      <div class="d-flex gap-2">
        <a href="{% url 'inscricoes:admin_geral_list_paroquias' %}" class="btn btn-outline-secondary btn-sm">Cancelar</a>
        <button form="paroquiaForm" type="submit" class="btn btn-primary btn-sm">Salvar</button>
      </div>
    </div>
  </div>

  <!-- Painel com formulário -->
  <section class="card-clean p-3 p-lg-4">
    <h2 class="h6 text-muted-2 mb-3"><i class="bi bi-building"></i> Dados da Paróquia</h2>

    {% if form.non_field_errors %}
      <div class="alert alert-danger">
        {% for e in form.non_field_errors %}<div>{{ e }}</div>{% endfor %}
      </div>
    {% endif %}

    <form method="post" enctype="multipart/form-data" novalidate id="paroquiaForm" class="row g-3">
      {% csrf_token %}

      {% for field in form %}
        {% with name=field.name|lower %}
          <div class="
            {% if 'nome' in name %}col-12
            {% elif 'email' in name %}col-12 col-md-6
            {% elif 'telefone' in name or 'cel' in name %}col-12 col-md-4
            {% elif 'cep' in name or 'estado' in name or 'uf' in name or 'numero' in name %}col-12 col-md-3
            {% elif 'cidade' in name %}col-12 col-md-6
            {% elif 'logo' in name or 'imagem' in name %}col-12
            {% else %}col-12 col-md-6{% endif %}
          ">
            <label class="form-label" for="{{ field.id_for_label }}">
              {{ field.label }}{% if field.field.required %}<span class="req">*</span>{% endif %}
            </label>

            {{ field }}

            {% if field.help_text %}<div class="form-text">{{ field.help_text|safe }}</div>{% endif %}

            {% if field.errors %}
              <div class="mt-1">
                {% for error in field.errors %}
                  <div class="alert alert-danger py-1 px-2 mb-1">{{ error }}</div>
                {% endfor %}
              </div>
            {% endif %}

            {% if 'logo' in name or 'imagem' in name %}
              <div class="logo-preview" data-logo-preview hidden>
                <img alt="Prévia do logo" aria-hidden="true"/>
                <span class="text-muted-2 small">Pré-visualização do arquivo selecionado.</span>
              </div>
            {% endif %}
          </div>
        {% endwith %}
      {% endfor %}

      <div class="col-12 d-flex gap-2 justify-content-end">
        <a href="{% url 'inscricoes:admin_geral_list_paroquias' %}" class="btn btn-outline-secondary btn-sm">Cancelar</a>
        <button type="submit" class="btn btn-primary btn-sm">Salvar</button>
      </div>
      <p class="small text-muted-2 m-0">Dica: use <kbd>Ctrl</kbd>+<kbd>Enter</kbd> (ou <kbd>⌘</kbd>+<kbd>Enter</kbd>) para enviar.</p>
    </form>
  </section>

  <footer class="py-4">
    <div class="d-flex flex-wrap justify-content-between align-items-center text-muted-2 small">
      <div>© {% now "Y" %} Admin Geral — Todos os direitos reservados</div>
      <div>Desenvolvido por Alexandre Martins Vieira • Bootstrap 5</div>
    </div>
  </footer>
</main>

<script>
  // Tema com persistência (mesma chave das outras telas)
  (function themeToggle(){
    const KEY='relatorios-theme';
    const btn=document.getElementById('themeToggle');
    const root=document.documentElement;
    function apply(theme){
      if(theme==='dark'){ root.dataset.theme='dark'; document.documentElement.style.colorScheme='dark'; }
      else if(theme==='light'){ root.dataset.theme='light'; document.documentElement.style.colorScheme='light'; }
      else{ root.removeAttribute('data-theme'); document.documentElement.style.colorScheme='light dark'; }
    }
    apply(localStorage.getItem(KEY) || 'auto');
    btn?.addEventListener('click', ()=>{
      const cur=localStorage.getItem(KEY)||'auto';
      const next= cur==='auto' ? 'dark' : cur==='dark' ? 'light' : 'auto';
      localStorage.setItem(KEY,next); apply(next);
      btn.setAttribute('aria-label',`Tema: ${next}`);
    });
  })();

  // UX do formulário: foco, Ctrl/Cmd+Enter, máscaras e prévia do logo
  (function formUX(){
    const form = document.getElementById('paroquiaForm');
    if(!form) return;

    // Foco no primeiro campo “texto/seleção”
    const first = form.querySelector('input:not([type=file]), select, textarea');
    first && first.focus();

    // Ctrl/Cmd + Enter para enviar
    document.addEventListener('keydown', (e)=>{
      if((e.ctrlKey || e.metaKey) && e.key.toLowerCase()==='enter'){
        e.preventDefault();
        form.requestSubmit();
      }
    });

    // Máscara leve para telefone
    form.querySelectorAll('input[type="tel"]').forEach(p=>{
      p.addEventListener('input', ()=>{
        let v = p.value.replace(/\D/g,'').slice(0,11);
        if(v.length > 10) p.value = v.replace(/(\d{2})(\d{5})(\d{4})/,'($1) $2-$3');
        else if(v.length > 6) p.value = v.replace(/(\d{2})(\d{4})(\d{0,4})/,'($1) $2-$3');
        else if(v.length > 2) p.value = v.replace(/(\d{2})(\d{0,5})/,'($1) $2');
        else p.value = v;
      });
    });

    // Máscara leve para CEP
    form.querySelectorAll('input[name*="cep" i]').forEach(cep=>{
      cep.addEventListener('input', ()=>{
        let v = cep.value.replace(/\D/g,'').slice(0,8);
        if(v.length > 5) cep.value = v.replace(/(\d{5})(\d{0,3})/,'$1-$2');
        else cep.value = v;
      });
    });

    // UF/Estado em maiúsculas (2 letras)
    form.querySelectorAll('input[name*="estado" i], input[name*="uf" i]').forEach(uf=>{
      uf.maxLength = 2;
      uf.addEventListener('input', ()=>{ uf.value = uf.value.replace(/[^a-zA-Z]/g,'').toUpperCase().slice(0,2); });
    });

    // Pré-visualização do logo
    const file = form.querySelector('input[type="file"][name*="logo" i], input[type="file"][name*="imagem" i]');
    if(file){
      const wrap = form.querySelector('[data-logo-preview]');
      const img = wrap?.querySelector('img');
      file.addEventListener('change', ()=>{
        const f = file.files && file.files[0];
        if(f && /^image\//.test(f.type)){
          const reader = new FileReader();
          reader.onload = e => { if(img){ img.src = e.target.result; wrap.hidden = false; } };
          reader.readAsDataURL(f);
        }else{
          if(img){ img.removeAttribute('src'); wrap.hidden = true; }
        }
      });
    }
  })();
</script>
</body>
</html>
