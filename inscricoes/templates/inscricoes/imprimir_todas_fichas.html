{% load static %}
<!doctype html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<title>Todas as Fichas — {{ evento.nome|default:"não informado" }}</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<!-- Bootstrap 5 -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>

<!-- Font Awesome -->
<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
      integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkfSLzLQvWQ2zYlH3xZkS2VJKJQGXrCM1/MrZ8Dq03+4T6pG8Y2LRp5kw=="
      crossorigin="anonymous" referrerpolicy="no-referrer" />

<style>
  /* ======= Tokens / tema (padrão painel) ======= */
  :root{
    --ink:#0f172a; --muted:#64748b; --line:#e5e7eb; --panel:#fff;
    --shadow:0 10px 24px rgba(17,24,39,.08);
    --g1:#0b1020; --g2:#111a3a;               /* navbar gradiente */
    --accent:#2563eb; --accent-2:#1d4ed8;     /* botões */
    --base-font:14px;
  }
  html{ font-size:var(--base-font); }
  body{ background:#f6f8fb; color:var(--ink); }

  /* Navbar */
  .nav-pro{ background:linear-gradient(90deg,var(--g1),var(--g2)); }
  .navbar .btn{ font-size:.85rem; padding:.35rem .6rem; }
  .navbar-brand{ font-size:1rem; }

  /* Cartões e títulos */
  .card-clean{
    border:1px solid var(--line); border-radius:.95rem; background:#fff;
    box-shadow:var(--shadow);
    transition:transform .12s ease, box-shadow .12s ease, border-color .12s ease, filter .12s ease;
  }
  .card-clean:hover{ transform:translateY(-2px); box-shadow:0 14px 36px rgba(17,24,39,.12); border-color:#dbe1ea; filter:brightness(1.02) }
  .sec-title{
    font-size:.95rem; color:var(--muted); text-transform:uppercase; letter-spacing:.04em;
    margin:0 0 .75rem; font-weight:700; display:flex; align-items:center; gap:.5rem;
  }
  .text-muted-2{ color:var(--muted); }

  /* ======= Página A4 (retrato) + impressão ======= */
  @page{ size: A4 portrait; margin: 10mm; }
  @media print{
    .no-print{ display:none !important; }
    body{ background:#fff; }
    .card-clean{ box-shadow:none !important; }
  }

  /* ======= Folha de ficha ======= */
  .sheet{
    max-width:210mm; margin:0 auto 14px; padding:10mm 8mm 8mm; position:relative;
    page-break-after: always; page-break-inside: avoid;
    border:1px solid var(--line); border-radius:10px; background:#fff; box-shadow:var(--shadow);
    font-size:12px; line-height:1.35;   /* mais compacto dentro da ficha */
  }
  .hr{ height:1px; background:var(--line); margin:8px 0 10px; }

  /* Cabeçalho da ficha */
  .top{ display:grid; grid-template-columns: 1fr auto; gap:12px; align-items:center; }
  .t-left .eyebrow{ font-size:10px; color:var(--muted); margin:0 0 2px; }
  .t-title{ margin:0; font-weight:800; font-size:16px; line-height:1.1; letter-spacing:.2px; }
  .t-sub{ margin:4px 0 0; color:var(--muted); font-size:9px; max-width:120mm; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

  .media{ display:flex; align-items:center; gap:10px; }
  .photo{ width:58px; height:58px; border-radius:8px; object-fit:cover; border:1px solid var(--line); background:#f8fafc; }
  .photo.-empty{ display:grid; place-items:center; color:#9ca3af; font-size:10px; }
  .qr-wrap{ display:grid; grid-template-rows:auto 1fr; justify-items:center; gap:4px; }
  .qr{ width:76px; height:76px; border:1px solid var(--line); border-radius:6px; padding:2px; background:#fff; }
  .qr-caption{ font-size:9px; color:var(--muted); }

  /* Seções / grid */
  .sec{ margin:10px 0 12px; }
  .sec h3{
    margin:0 0 6px; font-size:10px; letter-spacing:.3px; color:#111; text-transform:uppercase;
  }
  .grid{ display:grid; grid-template-columns: repeat(18, 1fr); gap:6px 6px; }
  .f{ display:flex; flex-direction:column; min-width:0; }
  .f label{ font-size:9px; color:var(--muted); margin-bottom:2px; line-height:1; letter-spacing:.2px; }
  .v{
    border:1px solid var(--line); border-radius:6px; padding:6px 8px; min-height:24px;
    display:flex; align-items:center; background:#fff; overflow:hidden; white-space:nowrap; text-overflow:ellipsis;
    font-size:10px;
  }
  .v-wrap{ white-space:normal; word-break:break-word; overflow:visible; }

  /* Spans */
  .span-18{grid-column:span 18}.span-16{grid-column:span 16}.span-12{grid-column:span 12}
  .span-10{grid-column:span 10}.span-9{grid-column:span 9}
  .span-8{grid-column:span 8}.span-7{grid-column:span 7}
  .span-6{grid-column:span 6}.span-5{grid-column:span 5}
  .span-4{grid-column:span 4}.span-3{grid-column:span 3}
  .span-2{grid-column:span 2}.span-1{grid-column:span 1}

  /* Rodapé da ficha */
  .footer{ margin-top:10px; text-align:center; font-size:9px; color:var(--muted); }

  /* Ajustes para impressão (mais compacto) */
  @media print{
    .sheet{ font-size:10.5px; line-height:1.25; box-shadow:none !important; }
    .t-title{ font-size:14px }
    .t-sub{ font-size:9px; max-width:140mm }
    .photo{ width:50px; height:50px }
    .qr{ width:68px; height:68px }
    .v{ font-size:9.8px }
  }

  /* Botão gradiente (usado no header de ações) */
  .btn-grad{
    background:linear-gradient(135deg, var(--accent), var(--accent-2));
    color:#fff; border:0;
  }
  .btn-grad:hover{ filter:brightness(1.02) }
</style>
</head>
<body>

<!-- NAVBAR -->
<nav class="navbar nav-pro navbar-dark no-print">
  <div class="container-fluid">
    <a class="navbar-brand fw-bold" href="{% url 'inscricoes:relatorios_evento' evento.id %}">
      <i class="fa-solid fa-arrow-left me-2"></i> Relatórios
    </a>
    <span class="navbar-text text-white-50 d-none d-md-inline">{{ evento.nome|default:"não informado" }}</span>
    <div class="d-flex align-items-center gap-2 ms-auto">
      <button class="btn btn-light btn-sm" onclick="window.print()">
        <i class="fa-solid fa-print me-1"></i> Imprimir
      </button>
    </div>
  </div>
</nav>

<main class="container py-3">
  <!-- Header / Ações -->
  <section class="card-clean p-3 p-md-4 mb-3 no-print">
    <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
      <div>
        <h1 class="h6 m-0">Todas as Fichas</h1>
        <div class="small text-muted-2">{{ evento.nome|default:"não informado" }}</div>
      </div>
      <div class="d-flex gap-2">
        <button type="button" class="btn btn-outline-secondary btn-sm" onclick="history.back()">
          <i class="fa-solid fa-arrow-left me-1"></i> Voltar
        </button>
        <button type="button" class="btn btn-grad btn-sm" onclick="window.print()">
          <i class="fa-solid fa-print me-1"></i> Imprimir
        </button>
      </div>
    </div>
  </section>

  <!-- FICHAS -->
  {% for inscricao in inscricoes %}
  {% with base=inscricao.inscricaosenior|default:inscricao.inscricaojuvenil|default:inscricao.inscricaomirim|default:inscricao.inscricaoservos %}
  <div class="sheet">
    <!-- Cabeçalho -->
    <div class="top">
      <div class="t-left">
        <div class="eyebrow">Ficha de inscrição</div>
        <h1 class="t-title">{{ evento.nome|default:"não informado" }}</h1>
        <div class="t-sub">
          Inscrição Nº {{ inscricao.id }} • Participante: {{ inscricao.participante.nome|default:"não informado" }}
        </div>
      </div>
      <div class="media">
        {% if inscricao.participante.foto %}
          <img class="photo" src="{{ inscricao.participante.foto.url }}" alt="Foto do participante">
        {% else %}
          <div class="photo -empty">sem foto</div>
        {% endif %}
        <div class="qr-wrap">
          <img class="qr" src="{% url 'inscricoes:qr_code_png' inscricao.participante.qr_token %}" alt="QR participante">
          <div class="qr-caption">Check-in</div>
        </div>
      </div>
    </div>

    <div class="hr"></div>

    <!-- Participante -->
    <div class="sec">
      <h3>Participante</h3>
      <div class="grid">
        <div class="f span-12"><label>Nome</label><div class="v">{{ inscricao.participante.nome|default:"não informado" }}</div></div>
        <div class="f span-3"><label>Nasc.</label><div class="v">{{ base.data_nascimento|date:"d/m/Y"|default:"não informado" }}</div></div>
        <div class="f span-3"><label>CPF</label><div class="v">{{ inscricao.participante.cpf|default:"não informado" }}</div></div>

        <div class="f span-4"><label>Telefone</label><div class="v">{{ inscricao.participante.telefone|default:"não informado" }}</div></div>
        <div class="f span-8"><label>E-mail</label><div class="v v-wrap">{{ inscricao.participante.email|default:"não informado" }}</div></div>
        <div class="f span-3"><label>CEP</label><div class="v">{{ inscricao.participante.CEP|default:"não informado" }}</div></div>
        <div class="f span-3"><label>Nº</label><div class="v">{{ inscricao.participante.numero|default:"não informado" }}</div></div>

        <div class="f span-8"><label>Endereço</label><div class="v v-wrap">{{ inscricao.participante.endereco|default:"não informado" }}</div></div>
        <div class="f span-4"><label>Bairro</label><div class="v">{{ inscricao.participante.bairro|default:"não informado" }}</div></div>
        <div class="f span-6"><label>Cidade</label><div class="v">{{ inscricao.participante.cidade|default:"não informado" }}</div></div>
        <div class="f span-2"><label>UF</label><div class="v">{{ inscricao.participante.estado|default:"não informado" }}</div></div>
      </div>
    </div>

    <!-- Dados adicionais -->
    <div class="sec">
      <h3>Dados adicionais</h3>
      <div class="grid">
        <div class="f span-2"><label>Altura</label><div class="v">{{ base.altura|default:"não informado" }}</div></div>
        <div class="f span-2"><label>Peso</label><div class="v">{{ base.peso|default:"não informado" }}</div></div>
        <div class="f span-2"><label>Batizado?</label><div class="v">{{ base.get_batizado_display|default:"não informado" }}</div></div>
        <div class="f span-4"><label>Estado civil</label><div class="v">{{ base.get_estado_civil_display|default:"não informado" }}</div></div>
        <div class="f span-4"><label>Casado na Igreja?</label><div class="v">{{ base.get_casado_na_igreja_display|default:"não informado" }}</div></div>

        <div class="f span-6"><label>Paróquia</label><div class="v v-wrap">{{ base.paroquia|default:"não informado" }}</div></div>
        <div class="f span-6"><label>Pastoral/Movimento</label><div class="v v-wrap">{{ base.pastoral_movimento|default:"não informado" }}</div></div>
        <div class="f span-6"><label>Outra Pastoral/Movimento</label><div class="v v-wrap">{{ base.outra_pastoral_movimento|default:"não informado" }}</div></div>

        <div class="f span-2"><label>Dizimista?</label><div class="v">{{ base.get_dizimista_display|default:"não informado" }}</div></div>
        <div class="f span-2"><label>Crismado?</label><div class="v">{{ base.get_crismado_display|default:"não informado" }}</div></div>
        <div class="f span-2"><label>Camisa</label><div class="v">{{ base.tamanho_camisa|default:"não informado" }}</div></div>

        <div class="f span-12"><label>Indicado por</label><div class="v v-wrap">{{ base.indicado_por|default:"não informado" }}</div></div>
      </div>
    </div>

    <!-- Saúde -->
    <div class="sec">
      <h3>Saúde</h3>
      <div class="grid">
        <div class="f span-3"><label>Pressão alta?</label><div class="v">{{ base.get_pressao_alta_display|default:"não informado" }}</div></div>
        <div class="f span-3"><label>Diabetes?</label><div class="v">{{ base.get_diabetes_display|default:"não informado" }}</div></div>

        <div class="f span-2"><label>Prob. Saúde?</label><div class="v">{{ base.get_problema_saude_display|default:"não informado" }}</div></div>
        <div class="f span-7"><label>Qual?</label><div class="v v-wrap">{{ base.qual_problema_saude|default:"não informado" }}</div></div>
        <div class="f span-2"><label>Med. Ctrl.?</label><div class="v">{{ base.get_medicamento_controlado_display|default:"não informado" }}</div></div>
        <div class="f span-7"><label>Qual?</label><div class="v v-wrap">{{ base.qual_medicamento_controlado|default:"não informado" }}</div></div>

        <div class="f span-4"><label>Protocolo</label><div class="v v-wrap">{{ base.protocolo_administracao|default:"não informado" }}</div></div>
        <div class="f span-2"><label>Mob. Red.?</label><div class="v">{{ base.get_mobilidade_reduzida_display|default:"não informado" }}</div></div>
        <div class="f span-6"><label>Qual?</label><div class="v v-wrap">{{ base.qual_mobilidade_reduzida|default:"não informado" }}</div></div>
        <div class="f span-2"><label>Tipo Sang.</label><div class="v">{{ base.tipo_sanguineo|default:"não informado" }}</div></div>
        <div class="f span-4"><label><!-- espaço --></label><div class="v" style="border:none;background:transparent;min-height:0;padding:0"></div></div>

        <div class="f span-2"><label>Alerg. Alim.?</label><div class="v">{{ base.get_alergia_alimento_display|default:"não informado" }}</div></div>
        <div class="f span-7"><label>Qual?</label><div class="v v-wrap">{{ base.qual_alergia_alimento|default:"não informado" }}</div></div>
        <div class="f span-2"><label>Alerg. Med.?</label><div class="v">{{ base.get_alergia_medicamento_display|default:"não informado" }}</div></div>
        <div class="f span-7"><label>Qual?</label><div class="v v-wrap">{{ base.qual_alergia_medicamento|default:"não informado" }}</div></div>

        <div class="f span-18"><label>Informações extras</label><div class="v v-wrap">{{ base.informacoes_extras|default:"não informado" }}</div></div>
      </div>
    </div>

    <!-- Cônjuge -->
    {% if inscricao.conjuge or base.nome_conjuge %}
    <div class="sec">
      <h3>Cônjuge</h3>
      <div class="grid">
        {% if inscricao.conjuge %}
          <div class="f span-10"><label>Nome</label><div class="v v-wrap">{{ inscricao.conjuge.nome|default:"não informado" }}</div></div>
          <div class="f span-4"><label>Inscrito?</label><div class="v">{{ inscricao.conjuge.get_conjuge_inscrito_display|default:"não informado" }}</div></div>
          <div class="f span-4"><label>Já é campista?</label><div class="v">{{ inscricao.conjuge.get_ja_e_campista_display|default:"não informado" }}</div></div>
        {% else %}
          <div class="f span-10"><label>Nome</label><div class="v v-wrap">{{ base.nome_conjuge|default:"não informado" }}</div></div>
          <div class="f span-4"><label>Inscrito?</label><div class="v">{{ base.get_conjuge_inscrito_display|default:"não informado" }}</div></div>
          <div class="f span-4"><label><!-- vazio --></label><div class="v" style="border:none;background:transparent;min-height:0;padding:0"></div></div>
        {% endif %}
      </div>
    </div>
    {% endif %}

    <!-- Paróquia (da inscrição) -->
    <div class="sec">
      <h3>Paróquia (Inscrição)</h3>
      <div class="grid">
        <div class="f span-10"><label>Paróquia</label><div class="v v-wrap">{{ inscricao.paroquia.nome|default:"não informado" }}</div></div>
        <div class="f span-6"><label>Cidade</label><div class="v">{{ inscricao.paroquia.cidade|default:"não informado" }}</div></div>
        <div class="f span-2"><label>UF</label><div class="v">{{ inscricao.paroquia.estado|default:"não informado" }}</div></div>
      </div>
    </div>

    <!-- Responsáveis -->
    <div class="sec">
      <h3>Responsáveis</h3>
      <div class="grid">
        <div class="f span-10"><label>Resp. 1 — Nome</label><div class="v v-wrap">{{ inscricao.responsavel_1_nome|default:"não informado" }}</div></div>
        <div class="f span-4"><label>Telefone</label><div class="v">{{ inscricao.responsavel_1_telefone|default:"não informado" }}</div></div>
        <div class="f span-3"><label>Grau</label><div class="v">{{ inscricao.responsavel_1_grau_parentesco|default:"não informado" }}</div></div>
        <div class="f span-1"><label>Camp.</label><div class="v">{% if inscricao.responsavel_1_ja_e_campista %}Sim{% else %}Não{% endif %}</div></div>

        <div class="f span-10"><label>Resp. 2 — Nome</label><div class="v v-wrap">{{ inscricao.responsavel_2_nome|default:"não informado" }}</div></div>
        <div class="f span-4"><label>Telefone</label><div class="v">{{ inscricao.responsavel_2_telefone|default:"não informado" }}</div></div>
        <div class="f span-3"><label>Grau</label><div class="v">{{ inscricao.responsavel_2_grau_parentesco|default:"não informado" }}</div></div>
        <div class="f span-1"><label>Camp.</label><div class="v">{% if inscricao.responsavel_2_ja_e_campista %}Sim{% else %}Não{% endif %}</div></div>
      </div>
    </div>

    <!-- Emergência -->
    <div class="sec">
      <h3>Contato de emergência</h3>
      <div class="grid">
        <div class="f span-10"><label>Nome</label><div class="v v-wrap">{{ inscricao.contato_emergencia_nome|default:"não informado" }}</div></div>
        <div class="f span-4"><label>Telefone</label><div class="v">{{ inscricao.contato_emergencia_telefone|default:"não informado" }}</div></div>
        <div class="f span-3"><label>Grau</label><div class="v">{{ inscricao.contato_emergencia_grau_parentesco|default:"não informado" }}</div></div>
        <div class="f span-1"><label>Camp.</label><div class="v">{% if inscricao.contato_emergencia_ja_e_campista %}Sim{% else %}Não{% endif %}</div></div>
      </div>
    </div>

    <!-- Rodapé -->
    <div class="footer">Desenvolvido por Alexandre Martins Vieira • Bootstrap 5</div>
  </div>
  {% endwith %}
  {% empty %}
  <div class="card-clean p-4 text-center text-muted">Nenhuma ficha para imprimir.</div>
  {% endfor %}
</main>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
